# MDN graph warnings

The [MDN graph](https://jc-verse.github.io/mdn-graph) generates a summary of [warnings](https://jc-verse.github.io/mdn-graph/warnings) by analyzing the **build output** of `mdn/content`. Some important caveats:

- It is not aware of Markdown source, or how Markdown source correlates to the HTML output. Therefore, we don't enforce that the content is written in any particular way (proper Markdown usage, macro usage, etc.), only that the rendered output is correct.
- Some reports are not easily fixable. For example, reports about duplicate IDs are usually because the content is dynamically generated by Yari and should be considered a platform bug rather than content bug.

Below is individual documentation for each warning message.

## Internal link issues

### Broken anchor

This rule checks for internal anchor links that don't point to an existing ID. The big benefit of analyzing build output is we can simultaneously avoid false-positives and false-negatives: it's both aware of anchor links generated by macros and IDs generated by macros! See also [mdn/mdn#561](https://github.com/mdn/mdn/issues/561).

Some reports are easier to fix than others. You may either find the content on another page, on this page with another name, or nowhere at all, in which case you need to either remove the link or write the referenced content.

### Broken link

This rule checks for internal links that don't point to an existing page. Note that broken _macros_ don't cause this rule to report, because broken macros are rendered without an `href` at all. Rather, they trigger the [Flaw macros](#flaw-macros) report.

Features in the [Web Docs backlog](https://openwebdocs.github.io/web-docs-backlog/all/) are automatically exempted from reporting. The reports would be gone once the target page gets written. We also maintain [a list of pages that could exist](https://github.com/jc-verse/mdn-graph/blob/master/config/no-page.txt), which are also not reported in the aggregation. You should combine these three resources to determine what actions need to be taken.

For things that get reported, you should consider whether it refers to a page that should exist (in which case add it to `no-page.txt` and write the page some time in the future), or the link is invalid (in which case replace it).

### Broken sidebar link

This rule is the sidebar counterpart of [broken link](#broken-link). Broken links generated by macros are reported by [bad sidebar link](#bad-sidebar-link).

> [!NOTE]
> General remark about sidebar reports: we do a best-effort deduplication of sidebar content. That is, if multiple pages render the same sidebar, it's only reported once for the first page that got checked.

### Image link

This rule reports internal image links (ending in one of the image extensions). It's generally a bad idea to provide links to them rather than directly displaying them and could be a typo. You don't need to wrap images in another `<a>`.

### Replace DT link with real target

This rule reports links to `<dt>`s where the `<dt>` contains a single link. You can usually replace such links with the actual `<a>` target, which is usually a page that offers more detail.

For example, you may have this on some page:

```md
This property reflects the [`x`](/en-US/docs/Web/HTML/Element/foo#x) attribute.
```

And the `<foo>` page has this:

```md
- [`x`](/en-US/docs/Web/HTML/Attribute/x)
  - Description of `x`.
```

In this case, you can replace the link with:

```md
This property reflects the [`x`](/en-US/docs/Web/HTML/Attribute/x) attribute.
```

Currently, this check only reports if the link to be replaced is a subpage of the original link. This ensures that if the DT links to a generic page like:

```md
- [`x`](/en-US/docs/Web/HTML/Attributes_in_general)
  - Description of `x`.
```

We don't lose information by replacing it.

### Self link

This rule reports links pointing to the page it's already on, including links that contain an anchor but also the full path. Some of them are generated by macros.

## External link issues

### Broken external link

> [!WARNING]
> This rule is a best-effort, for-your-information report. It's unlikely to false-negative (not report an actual broken link) but very likely to false-positive.

This rule extracts all external links and check whether they can be accessed. Unable to connect, timeout, invalid certificate would all cause this rule to report. The maximum timeout is 10s.

To fix the reports, go to the link and see if you can access it. If the site indeed cannot be accessed, remove the link or replace it with a valid one.

### External sandbox link

This rule reports `jsfiddle.net`/`jsbin.com`/`codepen.io` links. Internal examples using one of the MDN example repos or in-page using `EmbedLiveSample` are preferred. See [mdn/content#16120](https://github.com/mdn/content/issues/16120).

### HTTP link

This rule reports `http:` links. It would be mentioned if the `https:` equivalent is accessible. Most of the reports are unfixable because we don't remove links just because they are not HTTPS, but it would be a good candidate to consider for removal.

### Redirected external link

This rule reports external links that are redirected to a different URL, including when the trailing slash is different. Replace the link with the redirected location.

Known link shorteners for bug URLs are exempted and are reported when _not_ shortened by [unshortened bug link](#unshortened-bug-link).

### Unshortened bug link

This rule reports bug links where a known shortened version exists. For more information, see the [BCD lint rule](https://github.com/mdn/browser-compat-data/blob/main/lint/linter/test-links.ts).

In an editor, you can do the following regex replacements:

| Find                                                                                                  | Replace                   |
| ----------------------------------------------------------------------------------------------------- | ------------------------- |
| `https?:\/\/bugzilla\.mozilla\.org\/show_bug\.cgi\?id=(\d+)`                                          | `https://bugzil.la/$1`    |
| `https?:\/\/(issues\.chromium\.org)\/issues\/(\d+)`                                                   | `https://crbug.com/$2`    |
| `https?:\/\/(bugs\.chromium\.org\|code\.google\.com)\/p\/chromium\/issues\/detail\?id=(\d+)`          | `https://crbug.com/$2`    |
| `https?:\/\/(bugs\.chromium\.org\|code\.google\.com)\/p\/((?!chromium)\w+)\/issues\/detail\?id=(\d+)` | `https://crbug.com/$2/$3` |
| `https?:\/\/bugs\.webkit\.org\/show_bug\.cgi\?id=(\d+)`                                               | `https://webkit.org/b/$1` |

## Bad content

### Bad DL

This rule checks for Markdown syntax that's supposed to turn into a `<dl>` but is written incorrectly. We currently check two things:

- A `<li>` that starts with ": ".
- The text sequence "-: ".

To fix this, check the source code. For example:

```diff
  - Item1
    - : Description1
  - Item2
+   - : Description2

  - Item1
    - : Description1
  - Item2
    - : Description2
-   - : Description3
+       Description3
```

### Bad href

This rule checks for `<a>` `href`s in content that's not:

- An image link (which is reported by [a separate rule](#image-link))
- An internal link starting with `/en-US/`
- An internal anchor link starting with `#`
- An `http` link. Note that `localhost` URLs are also considered "bad", unless they point to live samples (because Yari generates localhost URLs for local builds)
- A `mailto:` link. We are considering whether this should be allowed but there are quite a few of these.

Common cases including `irc:` links (maybe they should be allowed?) and accidental relative links (`foo` instead of `/en-US/docs/Web/.../foo`).

### Code with space

This rule checks for `<a>` whose sole child is `<code>` whose text content contains a space. This is usually an error, such as using `domxref` to reference an API, but forgetting to remove code formatting (e.g. `{ {domxref("Fetch_API", "Fetch API")}}`). Code formatting should only be used when indicating code entities, but linkable code rarely contains spaces (unless it's demonstrating a function call, for example).

We have a wealth of exempted patterns and specific texts to filter out false positives. If false positives occur, consider adding them to [`check-content.ts`](https://github.com/jc-verse/mdn-graph/blob/master/src/server/check-content.ts) (for generalizable patterns) or [`allowed-code-link-text.txt`](https://github.com/jc-verse/mdn-graph/blob/master/config/allowed-code-link-text.txt) (for specific texts).

To fix these errors, the recommended way is to refactor it into a Markdown link (`[Fetch API](/en-US/docs/Web/API/Fetch_API)`), or, for the macros that support nocode-formatting, you can also pass the `"nocode"` parameter.

### Code with underscore

This is the underscore counterpart of [code with space](#code-with-space) and could arise from usage of macros such as `{ {domxref("Fetch_API")}}`. We also have exceptions encoded in `check-content.ts` and `allowed-code-link-text.txt`.

### Duplicate specifications

This rule reports multiple `{ {Specifications}}` macros on the same page. This is generally a content bug.

### Missing data

Yari does not generate flaws for `{ {CSSSyntax}}` and `{ {CSSInfo}}` that are missing data. See [mdn/yari#8436](https://github.com/mdn/yari/issues/8436) and [mdn/yari#4487](https://github.com/mdn/yari/pull/4487).

### Missing sidebar

This rule reports pages without a sidebar. All pages should be associated with a sidebar.

### Possibly unrendered Markdown

This rule reports plain text that looks like Markdown. This can either be because the Markdown is nested within other HTML (usually tables), or because it's using awkward text that must be escaped. The former should be replaced with the HTML equivalent and the latter should preferably be put into code spans.

### Quoted code

This rule reports the style ``"`code`"``. This is an outdated convention and should be replaced with `` `"code"` ``.

### Text stuck to code

This rule reports `code` spans that is immediately next to text that is not separated by whitespace. This rule is somewhat smart and:

- Won't report if the preceding text is actually on a separate line, such as via a `<br>` or another paragraph.
- Will report even if the `code` is not directly adjacent to the text, such as the structure `<a><code>foo</code></a><em>bar</em>`

It also won't report if the text is allowable punctuation, or common conventions such as `foo`s, `n`th, etc.

The reports are either typos or poorly-formatted macros. Consider either adding a space for separation or changing the macro:

```diff
- {{cssxref("display")}}`: block`
+ {{cssxref("display", "display: block")}}
```

## Yari flaws

### Flaw bad_bcd_queries

This rule reports the Yari `bad_bcd_queries` flaw. Fix reports by either adding BCD data, changing the query, or removing the compat table.

### Flaw broken_links

This rule reports the Yari `broken_links` flaw. Most of them are also caught by our warnings system, in which case [broken link](#broken-link) is emitted instead. Other times it reports [self links](#self-link), but its reports are not as complete because it doesn't seem to report macro-generated links. This report is generally ignorable and other broken link warnings should be prioritized.

### Flaw macros

This rule reports the Yari `macros` flaw. This includes non-existent pages (which are not reported by [broken link](#broken-link) because broken xref macros do not contain `href`), incorrect macros (due to redirects), deprecated parameters, etc.

## Reachability

### Unreachable via page

This rule reports pages that are unreachable via any in-page links (starting from `/en-US/docs/Web`). All pages should preferably be accessible via some link but it could false-positive for some pages that are meant to be "tucked away". You should consider whether it belongs to a feature group and should be linked from the landing page.

### Unreachable via sidebar

This rule reports pages that are unreachable via any sidebar. This is slightly trickier to fix until Yari fully exposes sidebar configuration to content; however, API sidebars are fully customizable.

## Other

These are warnings that are unlikely to be fixable in content and therefore deprioritized.

### Bad sidebar link

This rule reports any link in the sidebar that either has no `href` or the `href` doesn't start with `/en-US/`. It currently flags all links in the sidebar that are not internal links, and links generated by macros that point to nonexistent pages.

### Broken browser compat anchor

This is like [broken anchor](#broken-anchor) but is more likely a Yari bug. It checks for `#browser_compatibility` on pages without a browser compat section. This is nearly always because of the usage of the deprecated and experimental banners, which contain this anchor. This is unactionable.

### Duplicate ID

This rule reports identical `id`s on the same page. Unless the content is hand-writing `id`, this is nearly always a Yari bug/limitation.
